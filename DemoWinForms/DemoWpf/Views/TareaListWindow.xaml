<Window
    x:Class="DemoWpf.Views.TareaListWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:DemoWpf.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Lista de Tareas"
    Width="1100"
    Height="700"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Grid Margin="20">
  <Grid.RowDefinitions>
   <RowDefinition Height="Auto" />
  <RowDefinition Height="Auto" />
     <RowDefinition Height="*" />
    <RowDefinition Height="Auto" />
 </Grid.RowDefinitions>

 <TextBlock
   Grid.Row="0"
    Margin="0,0,0,20"
    FontSize="24"
     FontWeight="Bold"
  Text="Gestion de Tareas" />

        <Border
      Grid.Row="1"
  Margin="0,0,0,15"
          Padding="15"
    Background="#F5F5F5"
  BorderBrush="#CCCCCC"
   BorderThickness="1"
   CornerRadius="5">
         <Grid>
 <Grid.RowDefinitions>
<RowDefinition Height="Auto" />
    <RowDefinition Height="Auto" />
     </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,10">
        <Grid.ColumnDefinitions>
     <ColumnDefinition Width="*" />
     <ColumnDefinition Width="Auto" />
     <ColumnDefinition Width="Auto" />
     </Grid.ColumnDefinitions>

     <TextBox
   Grid.Column="0"
   Height="32"
       Padding="8"
    VerticalContentAlignment="Center"
  FontSize="14"
    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}">
       <TextBox.InputBindings>
    <KeyBinding Key="Return" Command="{Binding SearchCommand}" />
      </TextBox.InputBindings>
    </TextBox>

   <Button
   Grid.Column="1"
  Width="100"
     Height="32"
    Margin="10,0,0,0"
   Command="{Binding SearchCommand}"
          Content="Buscar"
     FontSize="14" />

      <Button
        Grid.Column="2"
      Width="120"
   Height="32"
  Margin="10,0,0,0"
       Command="{Binding ClearFiltersCommand}"
  Content="Limpiar Filtros"
 FontSize="14" />
            </Grid>

 <StackPanel Grid.Row="1" Orientation="Horizontal">
       <TextBlock
 Margin="0,0,10,0"
       VerticalAlignment="Center"
  FontSize="14"
         Text="Estado:" />
  <ComboBox
Width="150"
  Height="32"
   Margin="0,0,20,0"
       FontSize="14"
     ItemsSource="{Binding Estados}"
  SelectedItem="{Binding FiltroEstado}">
       <ComboBox.ItemTemplate>
    <DataTemplate>
     <TextBlock Text="{Binding}" />
     </DataTemplate>
   </ComboBox.ItemTemplate>
       </ComboBox>

       <TextBlock
       Margin="0,0,10,0"
    VerticalAlignment="Center"
     FontSize="14"
  Text="Prioridad:" />
       <ComboBox
   Width="150"
      Height="32"
    FontSize="14"
ItemsSource="{Binding Prioridades}"
  SelectedItem="{Binding FiltroPrioridad}">
  <ComboBox.ItemTemplate>
      <DataTemplate>
         <TextBlock Text="{Binding}" />
      </DataTemplate>
  </ComboBox.ItemTemplate>
       </ComboBox>
   </StackPanel>
</Grid>
        </Border>

        <Border
   Grid.Row="2"
    BorderBrush="#CCCCCC"
  BorderThickness="1"
  CornerRadius="5">
   <DataGrid
       AutoGenerateColumns="False"
     CanUserAddRows="False"
  IsReadOnly="True"
   ItemsSource="{Binding Tareas}"
       SelectedItem="{Binding SelectedTarea}"
       SelectionMode="Single">
     <DataGrid.Columns>
    <DataGridTextColumn
     Width="2*"
       Binding="{Binding Titulo}"
        Header="Titulo" />
  <DataGridTemplateColumn Width="1.5*" Header="Etiquetas">
         <DataGridTemplateColumn.CellTemplate>
      <DataTemplate>
     <ItemsControl ItemsSource="{Binding TareaEtiquetas}">
       <ItemsControl.ItemsPanel>
       <ItemsPanelTemplate>
       <WrapPanel />
      </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
       <ItemsControl.ItemTemplate>
         <DataTemplate>
       <Border
     Margin="2"
    Padding="5,2"
     Background="{Binding Etiqueta.ColorHex}"
     BorderBrush="#CCCCCC"
         BorderThickness="1"
       CornerRadius="10">
       <TextBlock
    FontSize="10"
  FontWeight="SemiBold"
    Foreground="White"
     Text="{Binding Etiqueta.Nombre}" />
  </Border>
   </DataTemplate>
        </ItemsControl.ItemTemplate>
     </ItemsControl>
                </DataTemplate>
    </DataGridTemplateColumn.CellTemplate>
    </DataGridTemplateColumn>
      <DataGridTextColumn
  Width="120"
    Binding="{Binding Estado}"
    Header="Estado" />
      <DataGridTextColumn
        Width="100"
       Binding="{Binding Prioridad}"
    Header="Prioridad" />
    <DataGridTextColumn
    Width="100"
    Binding="{Binding FechaVencimiento, StringFormat=dd/MM/yyyy}"
      Header="Fecha Venc." />
    <DataGridTemplateColumn Width="150" Header="Acciones">
      <DataGridTemplateColumn.CellTemplate>
        <DataTemplate>
     <StackPanel Orientation="Horizontal">
    <Button
  Width="60"
 Margin="2"
   Command="{Binding DataContext.EditTareaCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
  CommandParameter="{Binding}"
      Content="Editar" />
 <Button
   Width="70"
       Margin="2"
     Command="{Binding DataContext.DeleteTareaCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
  CommandParameter="{Binding}"
  Content="Eliminar" />
   </StackPanel>
        </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
       </DataGridTemplateColumn>
   </DataGrid.Columns>
    </DataGrid>
        </Border>

  <StackPanel
 Grid.Row="3"
   Margin="0,15,0,0"
HorizontalAlignment="Right"
 Orientation="Horizontal">
   <Button
   Width="100"
   Height="35"
            Margin="0,0,10,0"
 Command="{Binding ExportToCsvCommand}"
    Content="Exportar CSV"
 FontSize="12" />
       <Button
   Width="110"
   Height="35"
    Margin="0,0,10,0"
      Command="{Binding ExportToJsonCommand}"
    Content="Exportar JSON"
  FontSize="12" />
      <Button
   Width="120"
  Height="35"
    Margin="0,0,10,0"
 Command="{Binding NewTareaCommand}"
    Content="Nueva Tarea"
 FontSize="14" />
       <Button
   Width="100"
   Height="35"
 Click="CloseButton_Click"
    Content="Cerrar"
 FontSize="14" />
</StackPanel>

        <Grid
    Grid.RowSpan="4"
     Background="#80FFFFFF"
  Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
   <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
         <ProgressBar
         Width="200"
     Height="20"
           IsIndeterminate="True" />
  <TextBlock
   Margin="0,10,0,0"
        FontSize="14"
   Text="Cargando..." />
  </StackPanel>
  </Grid>
    </Grid>
</Window>
